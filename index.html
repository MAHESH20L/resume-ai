<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AI Resume Maker</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 700px;
      margin: 40px auto;
      padding: 20px;
      background: linear-gradient(135deg, #eef2f3, #8e9eab);
      color: #222;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
      border-radius: 12px;
    }
    h1, h2 {
      text-align: center;
      color: #222;
      margin-bottom: 15px;
      text-shadow: 1px 1px 2px #fff;
    }
    #questionContainer {
      background: #fff;
      padding: 25px 30px;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      margin-top: 30px;
    }
    label {
      font-weight: bold;
      display: block;
      margin-bottom: 8px;
      font-size: 18px;
      color: #333;
    }
    input[type="text"], textarea {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      margin-bottom: 20px;
      border: 1px solid #bbb;
      border-radius: 6px;
      resize: vertical;
      transition: border-color 0.3s;
    }
    input[type="text"]:focus, textarea:focus {
      border-color: #007bff;
      outline: none;
      box-shadow: 0 0 5px rgba(0,123,255,0.5);
    }
    button {
      background-color: #007bff;
      color: white;
      border: none;
      padding: 15px 0;
      font-size: 20px;
      cursor: pointer;
      border-radius: 8px;
      width: 100%;
      box-shadow: 0 4px 8px rgba(0,123,255,0.4);
      transition: background-color 0.3s ease;
    }
    button:hover:not(:disabled) {
      background-color: #0056b3;
    }
    button:disabled {
      background-color: #999;
      cursor: not-allowed;
      box-shadow: none;
    }
    .output {
      margin-top: 30px;
      padding: 25px;
      background: #fff;
      border-radius: 12px;
      white-space: pre-wrap;
      box-shadow: 0 0 12px rgba(0,0,0,0.14);
      font-size: 16px;
      color: #222;
    }
    .error {
      margin-top: 15px;
      color: red;
      font-weight: bold;
      text-align: center;
    }
    #downloadBtn {
      margin-top: 15px;
      background-color: #28a745;
      width: auto;
      padding: 12px 25px;
      font-weight: bold;
      font-size: 18px;
      box-shadow: 0 4px 8px rgba(40,167,69,0.4);
    }
    #downloadBtn:hover {
      background-color: #19692c;
    }
  </style>
</head>
<body>
  <h1>Welcome to AI Resume Maker</h1>

  <div id="questionContainer">
    <h2 id="questionTitle"></h2>
    <textarea id="answerInput" rows="5" placeholder=""></textarea>
    <button id="nextButton">Next</button>
    <div id="error" class="error"></div>
  </div>

  <div id="output" class="output" style="display:none;"></div>
  <button id="downloadBtn" style="display:none;">Download Word Resume</button>

  <script>
    const apiKey = "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";

    // Define all questions - chat based with follow-ups and conditionals
    const questionsList = [
      { key: "jobRole", question: "What job role do you want to prepare your resume for?", placeholder: "e.g., Software Developer" },
      { key: "name", question: "What is your full name?", placeholder: "Your full name" },

      // Following questions after name for contact details
      { key: "address", question: "[Your Address]", placeholder: "", optional: true },
      { key: "cityStateZip", question: "[City, State, ZIP]", placeholder: "", optional: true },
      { key: "email", question: "[Your Email]", placeholder: "example@mail.com", optional: true },
      { key: "phone", question: "[Your Phone Number]", placeholder: "", optional: true },
      { key: "profile", question: "[LinkedIn Profile / GitHub Profile]", placeholder: "LinkedIn or GitHub URL", optional: true },

      { key: "education", question: "What is your education background?", placeholder: "Degrees, colleges, years, etc." },

      // After education, ask for certifications and affiliations
      { key: "certifications", question: "List your certifications (or say 'No' if none)", placeholder: "Certification names", optional: true },
      { key: "affiliations", question: "List professional affiliations (or say 'No' if none)", placeholder: "Organizations, memberships", optional: true },

      { key: "skills", question: "What are your key skills?", placeholder: "Programming, tools, soft skills" },
      { key: "objective", question: "What is your career objective?", placeholder: "Brief career goal" },
      { key: "workDone", question: "What have you done (projects, work experience)?", placeholder: "Details about work/projects" },
      { key: "activities", question: "What other activities or accomplishments do you want to mention?", placeholder: "", optional: true }
    ];

    let answers = {};
    let currentQuestionIndex = 0;

    const questionTitle = document.getElementById("questionTitle");
    const answerInput = document.getElementById("answerInput");
    const nextButton = document.getElementById("nextButton");
    const errorDiv = document.getElementById("error");
    const outputDiv = document.getElementById("output");
    const questionContainer = document.getElementById("questionContainer");
    const downloadBtn = document.getElementById("downloadBtn");

    function showQuestion(index) {
      errorDiv.textContent = "";
      const q = questionsList[index];
      questionTitle.textContent = q.question;
      answerInput.value = "";
      answerInput.placeholder = q.placeholder || "";
      answerInput.rows = (q.key === "workDone" || q.key === "activities" || q.key === "education" || q.key === "objective") ? 5 : 2;
      answerInput.focus();
      if (index === questionsList.length - 1) {
        nextButton.textContent = "Generate Resume";
      } else {
        nextButton.textContent = "Next";
      }
    }

    function validateAnswer(text) {
      return text.trim().length > 0;
    }

    // Helper to know if user said no for optional section
    function isNegativeAnswer(text) {
      if (!text) return false;
      const neg = text.toLowerCase().trim();
      return ["no", "nope", "none", "not applicable", "i do not have", "don't have", "na"].includes(neg);
    }

    function buildPrompt(answers) {
      // Build resume prompt for AI, skipping optional empty responses or negative answers
      let prompt = `Create a detailed, professional resume for a person with the following details:\n\n`;

      prompt += `Job Role: ${answers.jobRole}\n`;
      prompt += `Full Name: ${answers.name}\n`;

      const contactFields = ["address", "cityStateZip", "email", "phone", "profile"];
      let contactSection = "";
      contactFields.forEach(f => {
        if (answers[f] && !isNegativeAnswer(answers[f])) {
          contactSection += answers[f] + "\n";
        }
      });
      if (contactSection) prompt += `Contact Details:\n${contactSection}\n`;

      prompt += `Education Background: ${answers.education}\n`;

      if (answers.certifications && !isNegativeAnswer(answers.certifications))
        prompt += `Certifications: ${answers.certifications}\n`;

      if (answers.affiliations && !isNegativeAnswer(answers.affiliations))
        prompt += `Professional Affiliations: ${answers.affiliations}\n`;

      prompt += `Skills: ${answers.skills}\n`;
      prompt += `Career Objective: ${answers.objective}\n`;
      prompt += `Work Experience / Projects: ${answers.workDone}\n`;

      if (answers.activities && !isNegativeAnswer(answers.activities))
        prompt += `Other Activities / Achievements: ${answers.activities}\n`;

      prompt += `\nMake the resume well-structured with headings underlined and bolded, suitable for a professional Word document.`;

      return prompt;
    }

    // Convert text output to simple Word doc with bold+underlined headings
    function generateWordDoc(resumeText) {
      // Simple HTML Word content -- bold+underline headings using regex to find headings

      // Heuristics: split resume by headings (lines ending with colon)
      // We'll make such lines bold and underlined in HTML

      let html = '<html><head><meta charset="UTF-8"><title>Resume</title></head><body style="font-family: Arial, sans-serif; padding: 30px;">';

      // Split lines
      const lines = resumeText.split("\n");
      lines.forEach(line => {
        if (line.trim().endsWith(":")) {
          // Heading line
          html += `<p style="font-weight:bold; text-decoration: underline; font-size:18px; margin-top:18px;">${line.trim()}</p>`;
        } else if (line.trim() === "") {
          html += `<br/>`;
        } else {
          html += `<p style="font-size:16px; margin: 5px 0;">${line.trim()}</p>`;
        }
      });

      html += "</body></html>";

      return html;
    }

    async function generateResume() {
      const prompt = buildPrompt(answers);

      try {
        nextButton.disabled = true;
        nextButton.textContent = "Generating...";

        const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer " + apiKey,
          },
          body: JSON.stringify({
            model: "gpt-4o-mini",
            messages: [
              { role: "system", content: "You are a professional resume writer." },
              { role: "user", content: prompt }
            ],
            max_tokens: 700
          })
        });

        if (!response.ok) {
          throw new Error("API error: " + response.statusText);
        }

        const data = await response.json();
        const resume = data.choices?.[0]?.message?.content || "No response from API.";
        outputDiv.style.display = "block";
        outputDiv.textContent = resume;
        questionContainer.style.display = "none";

        // Show Download button
        downloadBtn.style.display = "inline-block";

        // Save for download generation
        downloadBtn.onclick = () => {
          const htmlContent = generateWordDoc(resume);
          const blob = new Blob([htmlContent], { type: "application/msword" });
          const url = URL.createObjectURL(blob);

          const a = document.createElement("a");
          a.href = url;
          a.download = `${answers.name.replace(/\s/g, "_")}_Resume.doc`;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
        };

      } catch (error) {
        errorDiv.textContent = error.message;
        nextButton.disabled = false;
        nextButton.textContent = "Generate Resume";
      }
    }

    nextButton.addEventListener("click", () => {
      const answer = answerInput.value;
      if (!validateAnswer(answer)) {
        errorDiv.textContent = "Please provide an answer to continue.";
        return;
      }
      errorDiv.textContent = "";

      answers[questionsList[currentQuestionIndex].key] = answer.trim();

      currentQuestionIndex++;
      if (currentQuestionIndex >= questionsList.length) {
        generateResume();
      } else {
        showQuestion(currentQuestionIndex);
      }
    });

    // Start first question
    showQuestion(currentQuestionIndex);
  </script>
</body>
</html>
